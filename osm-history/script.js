'use strict';var width=.9*window.innerWidth;var height=.96*window.innerHeight-180;var timestampMin='2007-10-01T00:00:00Z';$(document).ready(function(){var featureToTimeFrom=function featureToTimeFrom(f){return moment(f.properties.validFrom);};var featureToTimeTo=function featureToTimeTo(f){return moment(f.properties.validTo);};var map=L.map('map',{zoomControl:false,zoomSnap:0,scrollWheelZoom:false,touchZoom:false,boxZoom:false,doubleClickZoom:false,dragging:false});new L.StamenTileLayer('toner').setOpacity(.14).addTo(map);mapPreventDrag('timeslider');var svgLayers=[];var json2=null;var redrawFunction=function redrawFunction(json){return function(m){if(json===null)return;var json2b=R.filter(function(f){return moment(f.properties.validFrom).isSameOrBefore(m)&&moment(f.properties.validTo).isAfter(m);})(topojson.getObject(json).geometries);if(json2==json2b)return;json2=json2b;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=svgLayers[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var l=_step.value;l.removeFrom(map);}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}var geoJson={type:"FeatureCollection",features:json2.map(function(o){return topojson.feature(json,o);}).filter(function(f){return f.geometry!==null;})};svgLayers=[L.geoJSON(geoJson,{color:colorPrimaryDark,fillColor:colorPrimaryDark,fillOpacity:.4}).addTo(map)];};};var slider=new SliderTime({min:moment(timestampMin),max:moment(),width:width,playingHide:false,playingSpeed:10000,playingRestartOnEnd:false});new OptionsPanel({elements:[{type:'radio',name:'data',values:[['hd-schloss',{label:'Schloss',selected:true}],['hd-oldtown',{label:'Altstadt',selected:false}]]}],onStoreUpdate:function onStoreUpdate(store){return $.getJSON('../data/tmp/'+store.data+'.topojson',function(json){map.fitBounds(topojson.getBounds(json),{padding:[-(window.innerWidth-width)/2,-(window.innerHeight-height)/2]});slider.setCallback(redrawFunction(json));$("#timeslider > *").remove();var getTime=function getTime(featureToTime,f,tToCompare){return R.compose(R.reduce(f(function(t){return t.unix();}),tToCompare),R.map(featureToTime))(topojson.getObject(json).geometries);};slider.options.min=getTime(featureToTimeFrom,R.minBy,moment());slider.options.max=getTime(featureToTimeTo,R.maxBy,moment(0));slider=new SliderTime(slider.options);slider.stopPlaying();slider.setFrom(moment.add(slider.options.min,moment.duration(slider.options.max.diff(slider.options.min))));});}});initPage({infoDescription:'OSM data is modified to reflect changes of the environment, or to improve the quality of the data. These modifications are interesting to examine for an area to illustrate how the OSM data is changing over time.',infoIdea:[franzBenjaminMocnik],infoProgramming:[franzBenjaminMocnik,martinRaifer],infoData:[heigitDB()],infoLibraries:libsDefault.concat([libIonRangeSlider,libMomentRound,libTopoJSON]),init:function init(){initTooltip({selector:'input[name="data"]:first',text:'Choose different areas to examine.',positionMy:'bottom left',positionAt:'top center'});initTooltip({selector:'.irs-slider',text:'Drag to change the point in time',positionMy:'bottom left',positionAt:'top center'});initTooltip({selector:'.timesliderPlaying',text:'Click here to animate time',positionMy:'bottom right',positionAt:'top right'});}});});