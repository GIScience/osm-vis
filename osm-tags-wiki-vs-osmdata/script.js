'use strict';function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}var thresholds=[1,10,100,1000];var thresholdsPercent=[1,5,10,20];d3.json('../data/osm-tags-wiki-vs-osmdata.json',function(dataset){dataset.data.forEach(function(d){d['date-wiki']=new Date(d['date-wiki']);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=thresholds[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var threshold=_step.value;d['date-data-'+threshold]=new Date(d['date-data-'+threshold]);}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=thresholdsPercent[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _threshold=_step2.value;d['date-data-percent-'+_threshold]=new Date(d['date-data-percent-'+_threshold]);}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}d['count']=+d['count'];});var data=dataset.data;var dates=R.compose(R.map(moment),R.flatten)([R.map(R.prop('date-wiki'),data)].concat(_toConsumableArray(R.map(function(threshold){return R.map(R.prop('date-data-'+threshold),data);},thresholds)),_toConsumableArray(R.map(function(threshold){return R.map(R.prop('date-data-percent-'+threshold),data);},thresholdsPercent))));var datesInterval=[moment.min(dates),moment.max(dates)];var formatDate=d3.timeFormat('%Y-%m-%d');var width=window.innerWidth;var height=window.innerHeight;var svg=pageFixed(width,height,0,0);var x0=datesInterval;var y0=datesInterval;var x=d3.scaleUtc().domain(x0).range([0,width]);var y=d3.scaleUtc().domain(y0).range([height,0]);var r=d3.scalePow().exponent(.25).domain([0,1E7]).range([2,10]);var key=d3.scaleOrdinal(d3.schemeCategory20);var xAxis=d3.axisTop(x).ticks(12);var yAxis=d3.axisRight(y).ticks(12*height/width);var yAxis2=d3.axisLeft(y).ticks(12*height/width);var brush=d3.brush().on('end',function(){return brushended();});var idleTimeout=void 0;var idleDelay=350;initDataTooltip();svg.append('g').append('path').classed('diagonal',true).data([datesInterval]).attr('d',d3.line().x(x).y(y));svg.append('g').classed('brush',true).call(brush);var brushended=function brushended(){var s=d3.event.selection;if(!s){if(!idleTimeout)return idleTimeout=setTimeout(idled,idleDelay);x.domain(x0);y.domain(y0);r.range([2,10]);}else{x.domain([s[0][0],s[1][0]].map(x.invert,x));y.domain([s[1][1],s[0][1]].map(y.invert,y));r.range([4,20]);svg.select('.brush').call(brush.move,null);}zoom();};var idled=function idled(){idleTimeout=null;};var zoom=function zoom(){};var axes=svg.append('g').classed('axes',true);axes.append('g').classed('axis axis-x',true).attr('transform','translate(0, '+height+')').call(xAxis);axes.append('text').classed('axis-label',true).attr('x',width/2).attr('y',height-25).style('text-anchor','middle').text('first documentation in the OSM wiki');axes.append('g').classed('axis axis-y',true).call(yAxis);axes.append('g').classed('axis axis-y',true).attr('transform','translate('+width+', 0)').call(yAxis2);axes.append('text').classed('axis-label',true).classed('axis-label-y',true).attr('transform','rotate(-90)').attr('x',-height/2).attr('y',50).style('text-anchor','middle');var dataCircles=svg.selectAll('circle').data(data).enter().append('circle').attr('cx',function(d){return x(d['date-wiki']);}).attr('cy',function(d){return y(d['date-data-'+thresholds[0]]);}).attr('r',function(d){return r(d['count']);}).attr('fill',function(d){return key(d['key']);}).attr('opacity',.75).on('mouseover',function(d){return showDataTooltip(d3.event.pageX,d3.event.pageY,d['key']+'='+d['value'],tooltipText(d));}).on('mouseout',function(){return hideDataTooltip();});var thresholdToString=function thresholdToString(threshold){if(threshold==1)return'first use';else if(threshold==2)return threshold+'nd use';else if(threshold==3)return threshold+'rd use';else return threshold+'th use';};var thresholdPercentToString=function thresholdPercentToString(threshold){return threshold+'% of current use';};var tooltipText=function tooltipText(d){var text='<span class="date">'+formatDate(d['date-wiki'])+'</span> first documention in the OSM wiki';var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=thresholds[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var threshold=_step3.value;text+='<br><span class="date">'+formatDate(d['date-data-'+threshold])+'</span> '+thresholdToString(threshold)+' in the OSM database';}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=thresholdsPercent[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var _threshold2=_step4.value;text+='<br><span class="date">'+formatDate(d['date-data-percent-'+_threshold2])+'</span> '+thresholdPercentToString(_threshold2)+' in the OSM database';}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}return text;};var updateForThreshold=function updateForThreshold(threshold){zoom=function zoom(){var t=svg.transition().duration(750);svg.select('.axis-x').transition(t).call(xAxis);svg.select('.axis-y').transition(t).call(yAxis);svg.selectAll('circle').transition(t).attr('cx',function(d){return x(d['date-wiki']);}).attr('cy',function(d){return y(d['date-data-'+threshold]);}).attr('r',function(d){return r(d['count']);});svg.selectAll('.diagonal').transition(t).attr('d',d3.line().x(x).y(y));};var thresholdString=threshold.startsWith('percent-')?thresholdPercentToString(threshold.slice(8)):thresholdToString(threshold);d3.selectAll('.axis-label-y').text(thresholdString+' in OSM database');dataCircles.transition(idleDelay).attr('cy',function(d){return y(d['date-data-'+threshold]);});};var thresholdValues={};var thresholdValuesFirst=true;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=thresholds[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var threshold=_step5.value;if(thresholdValuesFirst){thresholdValuesFirst=false;thresholdValues[threshold]={label:thresholdToString(threshold),selected:true};}else{thresholdValues[threshold]=thresholdToString(threshold);}}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=thresholdsPercent[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var _threshold3=_step6.value;thresholdValues['percent-'+_threshold3]=thresholdPercentToString(_threshold3);}}catch(err){_didIteratorError6=true;_iteratorError6=err;}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return();}}finally{if(_didIteratorError6){throw _iteratorError6;}}}new OptionsPanel({elements:[{type:'radio',name:'threshold',values:thresholdValues}],onStoreUpdate:function onStoreUpdate(store){return updateForThreshold(store.threshold);}});$('.panel').css({marginBottom:-$('.panel').outerHeight()/2});initPage({infoDescription:'The core tags, which are used in OSM to describe nodes, ways, and relations, are usually documented in the <a href="https://wiki.openstreetmap.org/wiki/Map_Features" target="_blank">OSM wiki</a>. There is, however, no formal requirement to do so, and tags are, in consequence, used in the OSM database often before they are documented in the OSM wiki, if at all. This visualization explores how these two dates, the first (or later) use in the OSM database and the first documentation in the OSM wiki, correlate.',infoIdea:[martinRaifer],infoProgramming:[martinRaifer,franzBenjaminMocnik],infoData:[dataset],infoLibraries:libsDefault,init:function init(){initTooltip({selector:'circle:first',text:'The position of a point decodes the first use in the OSM wiki and the OSM database, and its radius relates to the number of uses in current data. Different colors refer to different tag keys.'});initTooltip({selector:'.diagonal',text:'A tag which is documented in the OSM wiki at the time of its first use in the OSM database is depicted on the diagonal',positionMy:'bottom right',positionAt:'center'});}});});