'use strict';var width=.8*window.innerWidth;var height=.96*window.innerHeight-160;$(document).ready(function(){d3.json('../data/naturalearth_ne_110m_admin_0_countries.topojson',function(datasetCountries){d3.json('../data/osm-node-changes-per-area.json',function(dataset){var dataTopoJson=datasetCountries.countries;dataTopoJson.objects.countries.geometries=dataTopoJson.objects.countries.geometries.filter(function(d){return d.properties.iso_a3!='ATA';});var dataGeoJson=topojson.feature(dataTopoJson,dataTopoJson.objects.countries);dataGeoJson.features=dataGeoJson.features.filter(function(f){return f.bbox[1]>-70;});var svg=pageFixed(width,height,0,16);var projection=d3.geoMercator().center([0,50]).fitSize([width,height],dataGeoJson);var path=d3.geoPath().projection(projection);svg.selectAll('.country').data(dataGeoJson.features).enter().append('path').classed('country',true).attr('d',path);var bbox=d3.geoBounds(dataGeoJson);var appendMeanSolarTime=function appendMeanSolarTime(className,label){var mst=svg.append('g').classed('meanSolarTime',true).classed(className,true);mst.append('text').attr('x',6).attr('y',projection([0,bbox[0][1]])[1]).text(label);mst.append('line').attr('x1',0).attr('y1',projection([0,bbox[0][1]])[1]+6).attr('x2',0).attr('y2',projection([0,bbox[1][1]])[1]-6);};appendMeanSolarTime('meanSolarTime8','8:00 am');appendMeanSolarTime('meanSolarTime12','12:00 (noon)');appendMeanSolarTime('meanSolarTime16','16:00 pm');var redraw=function redraw(m){var mFormatted=moment(m).round(10,'minutes').format('HH:mm');var changes=svg.selectAll('.changes').data(dataset.nodeChanges.filter(function(d){return d.timestamp==mFormatted;}),function(d){return d.lat,d.lon,d.count;});changes.enter().append('circle').classed('changes',true).attr('data-lon',function(d){return d.lon;}).attr('transform',function(d){return'translate('+projection([d.lon,d.lat])+')';}).attr('r',function(d){return Math.log(Math.sqrt(d.count))*1.5;});changes.exit().remove();svg.selectAll('.meanSolarTime8').attr('transform',function(d){return'translate('+projection([360*(1-1/24*(m.hour()+m.minute()/60+m.second()/3600-8)),0])[0]+', 0)';});svg.selectAll('.meanSolarTime12').attr('transform',function(d){return'translate('+projection([360*(1-1/24*(m.hour()+m.minute()/60+m.second()/3600-12)),0])[0]+', 0)';});svg.selectAll('.meanSolarTime16').attr('transform',function(d){return'translate('+projection([360*(1-1/24*(m.hour()+m.minute()/60+m.second()/3600-16)),0])[0]+', 0)';});};new SliderTime({min:moment('00:00','HH:mm'),max:moment('24:00','HH:mm'),fromMax:moment('23:50','HH:mm'),fromFraction:[6,2],step:600,show:function show(m){return m.isSame(moment('24:00','HH:mm'))?m.format('kk:mm'):m.format('HH:mm');},callback:redraw,width:width,label:'UTC',labelLeft:moment(dataset.dataTimestamp).subtract(1,'day').format('YYYY-MM-DD'),playingHide:false,playingSpeed:2});initPage({infoDescription:'OSM data is changed every day by users all over the world. Local knowledge can be used to map the environment, but also aerial photographs can be used for mapping. Many more methods for mapping exist, and some of them require to be at the mapped place – this is usually done during the day –, while others can be used when being remote – this might also be done when it is night at the mapped place. This visualization explores at which hour of the day and in which regions of the world nodes of the OSM database are added, modified, or deleted.',infoIdea:[franzBenjaminMocnik],infoProgramming:[franzBenjaminMocnik],infoData:[dataset,datasetCountries],infoLibraries:libsDefault.concat([libIonRangeSlider,libMomentRound,libTopoJSON]),init:function init(){initTooltip({selector:'.meanSolarTime12 text',text:'This is noon in mean solar time. The mean solar time usually slightly differs from local time according to the equation of time.',positionMy:'bottom left',positionAt:'top center'});initTooltip({selector:'.changes[data-lon="'+R.compose(R.apply(Math.min),R.mapObjIndexed(function(n){return $(n).data('lon');}))($('.changes'))+'"]:first',text:'The change of nodes in the OSM database is depicted by a disk. The area of the disk is logarithmic in the number of edited nodes. The larger the disk, the more nodes are changed.'});initTooltip({selector:'.irs-slider',text:'Drag to change the point in time',positionMy:'bottom left',positionAt:'top center'});initTooltip({selector:'.timesliderPlaying',text:'Click here to animate time',positionMy:'bottom right',positionAt:'top right'});}});});});});